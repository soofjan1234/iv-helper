## 文件索引同步的作用是什么

同步文件和数据库里的文件索引

本来是在网盘项目里实现这个功能，然后其它项目调用它，但是像相册、音乐都有自己需要的一些文件特性，比如exif、id3等，会使得网盘存储一些不需要的属性

所以加个中间层，文件索引同步器对文件进行同步，网盘、相册、音乐来使用文件索引同步器更新数据库，做到了单一职责以及解耦

## 为什么不用fsnotify

1. **不递归**：新建子目录要手动加 watcher
2. **内存问题**：目录多了 watcher 爆炸
3. **事件不可靠**：重命名会丢事件，批量操作会重复

 所以我直接换了方案，用 **主动轮询 + SQLite 状态机**，放弃实时性换取可靠性。

## 为什么是BFS而不是DFS

1. **用户体验**：BFS 先同步浅层目录，用户常用的文件夹能更快被索引到
2. **内存安全**：DFS 递归实现在目录层级很深时会栈溢出，BFS 用队列迭代更稳定
3. **代码简洁：**Go 的 channel 本身就是 FIFO 队列，天然适合 BFS，代码也更简洁

## What and Why is Functional Options

一种用**函数作为参数**来配置对象的设计模式

相比直接传参或传 Config 结构体，Functional Options

1. **可选参数**：调用方只传需要的，其他自动用默认值
2. **向后兼容**：新增配置项不破坏已有调用
3. **可校验**：在 Option 函数内可以做参数校验和默认值处理

## **状态机有哪些状态？状态转换是怎样的？**

Pending → InProgress → 删除（完成），服务重启时 InProgress 回退到 Pending

## **断点续传怎么实现的？**

1. 任务持久化到 SQLite
2. 服务重启调用 restoreInterruptedTask()
3. 将 InProgress 重置为 Pending，然后恢复执行

## **如何实现冗余过滤？**

任务级：isChildOrSameTask() 检查是否已存在父任务/相同任务

文件级：比较数据库记录与文件系统的差异，删除已不存在的文件